---
title: "EmployeePromotion"
output:
  pdf_document: default
  html_document: default
date: "2023-02-18"
---

Salama Mohamed-fadel Sidna:

  -Grupal
  
    La media de edad varia segunel el departamento ? 
    

```{r,eval=TRUE,echo=TRUE}


#Packages

install.packages("tidyverse")
install.packages("dplyr")
install.packages("magrittr")
install.packages("caret")
install.packages("plyr")
install.packages("rattle")
install.packages("gapminder")
install.packages("R.devices")
install.packages("RWeka")
install.packages("rpart.plot")
install.packages("RGtk2")
install.packages("rattle")


install.packages("factoextra")
install.packages("gridExtra")
install.packages("animation")
install.packages("ggfortify")


# libraries


library(dplyr)
library(rpart)
library(rpart.plot)
library(rattle)
library(ggplot2)
library(RColorBrewer)
library(ggfortify)
library(vcd)

require(corrplot)


library(magrittr)
library(lubridate)
library(tidyverse)
library(caret)
library(cluster)
library(factoextra)
library(gridExtra)
library(stats)

library(class)
library(plyr)


#seed
set.seed(1)
set.seed(28)
set.seed(678)
set.seed(123)
```



* Aquí empieza la parte grupal de Salama Mohamed-fadel Sidna

En esta parte empiezo con la lectura del dataset principal en nueva ds "data_Salama", identificar los diferentes variable y sus tipos ,y el nombre de variable y observaciones en la dataset principal.
<strong>Lectura del dataset data_Salama.csv</strong>
```{r,eval=TRUE,echo=TRUE}
data_Salama <- read.csv ("train.csv")
head(data_Salama,5)
```

<strong>Descripcion de dataset data_Salama</strong>
```{r,eval=TRUE,echo=TRUE}
str(data_Salama)

n_col <- ncol(data_Salama)
n_row <- nrow(data_Salama)

cat("Nombre de variables : ", n_col, ", y el nombre de instancias: ", n_row) 
```


<strong>Variables con valores NA</strong>
```{r,eval=TRUE,echo=TRUE}
cat("Los variables que contienen valore NA son: \n")
colnames(data_Salama)[colSums(is.na(data_Salama)) > 0]


cat("\n\n Nombre de NA en cada columna:  \n")
colSums(is.na(data_Salama))
```



<Strong>La media de edad varia segunel departamento ? </Strong>

******
# ANOVA DEPARATAMENTOS
******




<ol>
<li>Media edad por department
```{r,eval=TRUE,echo=TRUE,warning=FALSE, message=FALSE}

data_means_dep_age <- aggregate(data_Salama$age,                       
                        list(data_Salama$department),
                        mean)
data_means_dep_age
```
<li>boxplot de la media de edad de cada departamento
```{r,eval=TRUE,echo=TRUE,warning=FALSE, message=FALSE}

boxplot(data_Salama$age ~ data_Salama$department)                          
points(x = 1:nrow(data_means_dep_age),                            
       y = data_means_dep_age$x,
       col = "blue",
       pch = 16)
text(x = 1:nrow(data_means_dep_age),                               
     y = data_means_dep_age$x - 0.15,
     labels = paste(round(data_means_dep_age$x, 1)),
     col = "red")

```



</ol>
Realiza un análisis ANOVA para determinar si hay diferencias significativas en los valores medios de la variable edad 
según los departamentos.

Hipotesis:

H0:  No hay diferencias significativas en los valores medios de la variable edad 
según los departamentos.

H1:  Hay diferencias significativas en los valores medios de la variable edad 
según los departamentos.



```{r,eval=TRUE,echo=TRUE}
library(plyr)

#nombre de observaciones total
n_emp_total <- nrow(data_Salama)
n_emp_total

#nombre de empleadores en cada departamento
n_emp_dep <- ddply(data_Salama, .(department), nrow)
n_emp_dep

#nombre de departamentos
n_dep <- nrow(n_emp_dep)
n_dep

```


```{r,eval=TRUE,echo=TRUE,warning=FALSE, message=FALSE}
#Obtenemos el valor crítico de una distribución de Fisher para grados de libertad n_dep - 1 y n_emp_total - n_dep, y para una probabilidad 0.05
qf(0.05, n_dep - 1, n_emp_total - n_dep, lower.tail=F)
```

El valor F y su probabilidad
```{r,eval=TRUE,echo=TRUE,warning=FALSE, message=FALSE}
mi.aov = aov(age~department,data = data_Salama)
summary(mi.aov)
```


<ul>
<li> Conclusiones

la propia función R aov() ya nos dice que la probabilidad para el valor F 178 se sitúa en menos de 2e-14%.
Tenemos un valor F (178) posteriora mucho al valor  critico (1.938582), entonces rechazamoas la hipótesis nula. 

<li>Este resultado es de acuerdo a los análisis realizados en el apartado anterior por que hemos tenido dos medios con diferencia 
muy grande como por ejemplo el departamento de Financia tiene la media de edad 32.1 de edad y el departamento de operacion tine media 36.1 de edad. 
</ul>



<Strong>La edad de incorporación del empleador en la compañía varía según el género?</Strong>

******
# ANOVA GENERO
******

<ol>

<li>Crear la variable edad de incorporación del empleador en la compañía
```{r,eval=TRUE,echo=TRUE}
data_Salama <- data_Salama %>%
mutate(data_Salama, employee_start_age = as.numeric(data_Salama$age - data_Salama$length_of_service))
head(data_Salama,5)
```

<li>Media de edad de incorporación del empleador en la compañía por genero
```{r,eval=TRUE,echo=TRUE,warning=FALSE, message=FALSE}
data_means <- aggregate(data_Salama$employee_start_age,                       
                        list(data_Salama$gender),
                        mean)
data_means
```

<li>Presentar un boxplot de la variable employee_start_age para cada uno de los generos para haber una idea sobre la diferencia antes a pasar a defender la hipotesis
```{r,eval=TRUE,echo=TRUE,warning=FALSE, message=FALSE}

boxplot(data_Salama$employee_start_age ~ data_Salama$gender)                          
points(x = 1:nrow(data_means),                            
       y = data_means$x,
       col = "red",
       pch = 16)
text(x = 1:nrow(data_means),                               
     y = data_means$x - 0.15,
     labels = paste("Mean:", round(data_means$x, 1)),
     col = "red")

```
</ol>



Hipotesis:

H0:  No hay diferencias significativas en los valores medios de la variable employee_start_age 
según los grupos de la variable gender.

H1:  hay diferencias significativas en los valores medios de la variable employee_start_age 
según los grupos de la variable gender.


```{r,eval=TRUE,echo=TRUE}

library(plyr)

#nombre de observaciones total
n_obse_total <- nrow(data_Salama)

#nombre de observaciones para cada uno de los generos
n_eee <- ddply(data_Salama, .(gender), nrow)

#nombre de grupos
n_grupos <- nrow(n_eee)
n_grupos

```

#Obtenemos el valor crítico de una distribución de Fisher para grados de libertad n_grupos - 1 y n_obse_total - n_grupos, y para una probabilidad 0.05
```{r,eval=TRUE,echo=TRUE,warning=FALSE, message=FALSE}
qf(0.05, n_grupos - 1, n_obse_total - n_grupos, lower.tail=F)
```


```{r,eval=TRUE,echo=TRUE,warning=FALSE, message=FALSE}
mi.aov = aov(employee_start_age~gender,data = data_Salama)
summary(mi.aov)
```


<ul>
<li> Conclusiones 

la propia función R aov() ya nos dice que la probabilidad para el valor F 2.701 se sitúa en 10%.
Tenemos un valor F (2.701) inferior al valor  critico (3.841628), entonces aceptamos la hipótesis nula. 

<li> Este resultado es de acuerdo a los análisis realizados en el apartado anterior por que hemos tenido dos medios con diferencia 
muy baja ente 29.001226 y 28.911783. 

</ul>




<strong>Cuáles son los componentes que más explican la variabilidad de nuestro dataset?</strong>


Para responder a esta pregunta seguimos la tecnica de reduccion y luego aplicamos la tecnica de analisis de los componentes principales PCA.

******
# Técnica de reducción de la dimensión
******
<ol>
<li><b>Analisis de componentes principales creando un subconjunto de nuestra base de datos con las variables numéricas, y analizar sus correlaciones.</b></li>
</ol>

Empezamos con la matriz de correlaciones de estas variables

```{r,eval=TRUE,echo=TRUE,warning=FALSE, message=FALSE}
ep_PC=data_Salama[,c("no_of_trainings", "age", "previous_year_rating", "length_of_service", "avg_training_score")]
epc=cor(na.omit(ep_PC))
epc
```

<ul>
<li> Una correlacion de 4.6% entre los dos variables no_of_trainings y avg_training_score.
<li> Una correlacion de 62% entre los dos variables age y length_of_service, ademas de una correlacion baja de 0.57% entre los variables age y previous_year_rating. 
<li> Una correlacion de 7,5% entre los dos variables previous_year_rating y avg_training_score, ademas una correlacion baja de 0.12% entre la variable previous_year_rating y la variable length_of_service.
<li>  La variable numerica employee_start_age no esta incluida porque es resultado de una substitucion de dos variables numericos que existen en la Matrix que son age y length_of_service, para evitar la redundancia.
</ul>



******
# PCA 
******
</ol>
<li><b>Realizar la técnica PCA con las variables de la Matrix</b></li>

```{r,eval=TRUE,echo=FALSE,warning=FALSE, message=FALSE}
pca <- princomp(epc)
pca

```


<li><b>Contribucion de cada variable a cada componente</b></li>
```{r,eval=TRUE,echo=FALSE,warning=FALSE, message=FALSE}
print(cumsum(pca$sdev^2)/sum(pca$sdev^2))
```
</ol>



<ul>
<li> El componente 1 contiene el 52% de la variabilidad.
<li> El componente 1 más el componente 2 acumulan el 78% de la variabilidad.
<li> El componente 1 más el componente 2 más el componente 3 acumulan el 96% de la variabilidad, y así succesivamente.
<li> Vemos que solamente con los tres primeros componentes podemos explicar el 96,77% de la variabilidad de la dataset, 
de manera que el estudio de nuestra dataset principal sobre estos tres componentes será suficiente para entender aplicar una predicion rezonables.  
</ul>
